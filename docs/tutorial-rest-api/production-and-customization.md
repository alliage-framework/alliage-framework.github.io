---
sidebar_position: 11
title: 'Production & customization'
---

# Production and customization

Learn how to build your API for production, understand the build system, and customize your OpenAPI documentation.

## Building for production

When you're ready to deploy your API, Alliage provides a comprehensive build system that prepares your application for production environments.

### Build your application

Use the build command to compile and optimize your application:

```bash
yarn alliage:build
```

This command:
- **Compiles TypeScript** to optimized JavaScript
- **Bundles dependencies** for efficient deployment
- **Generates production assets** including OpenAPI schemas
- **Creates a deployable package** in the `dist/` directory

The build process creates a `dist/` folder containing everything needed to run your API in production.

### Understanding the build configuration

The build process is controlled by the `config/build.yaml` file, which defines a list of tasks to be executed:

```yaml title="config/build.yaml"
tasks:
  - name: typescript
    description: Compile TypeScript code
    params:
      projectPath: './tsconfig.json'
  - name: rest-generate-schema
    description: Generate REST API Schema
    params: {}
```

This configuration runs two main tasks:
- **`typescript`**: Compiles your TypeScript code into JavaScript using the settings in `tsconfig.json`.
- **`rest-generate-schema`**: Generates the `.alliage-rest-api-metadata.json` file required for the OpenAPI specification.

### Adding custom build tasks

You can add custom steps to your build process using the `shell` task. For example, the following task creates a compressed `tar` archive of the project after the build is complete:

```yaml title="config/build.yaml"
tasks:
  - name: typescript
    description: Compile TypeScript code
    params:
      projectPath: './tsconfig.json'
  - name: rest-generate-schema
    description: Generate REST API Schema
    params: {}
  - name: shell
    description: Create a deployment archive
    params:
      cmd: tar -czf deployment.tar.gz dist/ config/ package.json alliage-modules.json .alliage-rest-api-metadata.json
```

## Understanding the `.alliage-rest-api-metadata.json` file

This file is automatically generated by Alliage. It holds the metadata for each of your API's controllers, which is used to generate the OpenAPI schema. It must be present in the package deployed to production.

The metadata for each controller includes:
- The endpoint's path
- JSON schemas for parameters, query arguments, the request body, and the response body
- Details of potential errors

```json title=".alliage-rest-api-metadata.json"
{
  "post": [
    {
      "pattern": "/^(?:\\/api\\/meal-pairing)(?:\\/$)?$/i",
      "path": "/api/meal-pairing",
      "actionMetadata": {
        "controllerName": "MealPairingController",
        "name": "getMealPairing",
        "tags": [],
        "defaultStatusCode": 200,
        "validateInput": true,
        "validateOutput": true,
        "paramsType": {},
        "queryType": {},
        "bodyType": {
          "type": "object",
          "additionalProperties": false,
          "required": ["ingredient"],
          "properties": {
            "ingredient": {
              "type": "string",
              "enum": ["pepperoni", "lettuce", "rice"]
            }
          }
        },
        "returnType": {
          "type": "object",
          "additionalProperties": false,
          "required": ["meal", "cocktail"],
          "properties": {
            "meal": { "type": "string" },
            "cocktail": { "type": "string" }
          }
        },
        "errors": [
          {
            "description": "Error thrown when no ingredient is found in the meal database",
            "code": "404",
            "payloadType": {
              "type": "object",
              "additionalProperties": false,
              "required": ["message", "ingredient"],
              "properties": {
                "message": { "type": "string" },
                "ingredient": {
                  "type": "string",
                  "enum": ["pepperoni", "lettuce", "rice"]
                }
              }
            }
          }
        ]
      }
    }
  ]
}
```

### Generation Process

The `.alliage-rest-api-metadata.json` file is generated automatically.

- **In development mode**: It's regenerated each time a controller is updated.
- **At build time**: It's generated if the `rest-generate-schema` task is included in the project's `config/build.yaml`.

## Getting your OpenAPI schema

Alliage provides multiple ways to access your API's OpenAPI schema:

### Method 1: Live endpoint (development)

During development, access the live schema via HTTP:

```bash
# Get the complete OpenAPI schema
curl http://localhost:8080/api/specs

# Save schema to file
curl http://localhost:8080/api/specs > openapi-schema.json

# View in browser with interactive UI
open http://localhost:8080/api/specs
```

This endpoint provides:
- **Live schema** reflecting current code state
- **Real-time updates** as you modify your API

### Method 2: Command-line export

For production builds and CI/CD pipelines, use the dump command:

```bash
# Export schema to stdout
yarn alliage:run:dev rest:dump-schema

# Save to specific file
yarn alliage:run:dev rest:dump-schema > api-schema.json

# Generate multiple formats
yarn alliage:run:dev rest:dump-schema > openapi.json
npx swagger-codegen generate -i openapi.json -l typescript-axios -o ./sdk
```

### Using the schema in CI/CD

```yaml title=".github/workflows/api-docs.yml"
name: Generate API Documentation

on:
  push:
    branches: [main]

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: yarn install
        
      - name: Generate OpenAPI schema
        run: yarn alliage:run:dev rest:dump-schema > openapi.json
        
      - name: Generate SDK
        run: npx swagger-codegen generate -i openapi.json -l typescript-axios -o ./client-sdk
        
      - name: Deploy documentation
        run: |
          npx redoc-cli build openapi.json --output docs/index.html
          aws s3 sync docs/ s3://api-docs-bucket/
```

## Customizing OpenAPI documentation

Enhance your API documentation by customizing the OpenAPI specification:

### Basic configuration

Update `config/rest-api-openapi-specs.yaml` to customize your API documentation:

```yaml title="config/rest-api-openapi-specs.yaml"
# OpenAPI specification customization
info:
  title: "Meal Pairing API"
  description: |
    An intelligent API that suggests cocktail pairings for meals based on 
    cuisine type, ingredients, and flavor profiles.
    
    ## Features
    - Smart meal-to-cocktail pairing algorithm
    - Real-time data from TheMealDB and TheCocktailDB
    - Type-safe validation with clear error messages
    - Comprehensive testing coverage
    
  version: "1.0.0"
  contact:
    name: "API Support"
    url: "https://example.com/support"
    email: "support@example.com"
  license:
    name: "MIT"
    url: "https://opensource.org/licenses/MIT"

# Server configuration
servers:
  - url: "http://localhost:8080"
    description: "Development server"
  - url: "https://api.example.com"
    description: "Production server"
  - url: "https://staging-api.example.com"
    description: "Staging server"

# External documentation
externalDocs:
  description: "Complete API Documentation"
  url: "https://docs.example.com/meal-pairing-api"
```

## Next steps

Now that you've learned how to build and customize your API, let's wrap things up.

**[Conclusion â†’](/docs/tutorial-rest-api/conclusion)**
